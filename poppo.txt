sudo apt update
sudo apt install -y linux-modules-extra-$(uname -r)
sudo modprobe binder_linux devices="binder,hwbinder,vndbinder"
echo "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] https://download.docker.com/linux/ubuntu $(. /etc/os-release && echo "$VERSION_CODENAME") stable" | sudo tee /etc/apt/sources.list.d/docker.list > /dev/null
sudo apt update
lsmod | grep binder
lsmod | grep ashmem 
sudo docker run -itd --privileged --restart unless-stopped   -v ~/data1:/data     -p 5551:5555     erstt/redroid:13.0.0_ndk_magisk_litegapps_ChromeOS

sudo docker run -itd --privileged --restart unless-stopped   -v ~/data2:/data     -p 5551:5555 erstt/redroid:13.0.0_ndk_magisk_litegapps_ChromeOS
sudo docker ps
sudo apt update
sudo apt install -y x11-utils
sudo apt update
sudo apt install -y adb
sudo adb connect 127.0.0.1:5555
sudo apt install -y scrcpy
df -h
"sudo docker system prune -a -f" #incase needed but not needed her
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs
sudo apt update
sudo apt install python3 make g++ build-essential
sudo npm install -g node-gyp
sudo apt install git
adb connect localhost:5555
git clone https://github.com/NetrisTV/ws-scrcpy.git
cd ws-scrcpy
npm install
npm start # if not work try "WS_SCRCPY_PORT=8080 npm start"
# run it in the background with a tool like pm2:
npm install -g pm2  
pm2 start npm --name ws-scrcpy -- start
npm start

sudo apt update  # Refresh if needed, ignoring errors for now
sudo apt install ca-certificates curl  # Install prerequisites if not already present
sudo install -m 0755 -d /etc/apt/keyrings
sudo curl -fsSL https://download.docker.com/linux/ubuntu/gpg -o /etc/apt/keyrings/docker.asc
sudo chmod a+r /etc/apt/keyrings/docker.ascsudo apt update  # Refresh if needed, ignoring errors for now

|--------------------------------------------------------------------------------------------------------|

Step 1: Try Enabling Root ADB (Easiest if It Works)

Run: adb root
Expected output: "restarting adbd as root"
If it fails (e.g., "adbd cannot run as root in production builds"), skip to Step 2.

Then: adb shell
You should see a # prompt (root shell).

Run the query: sqlite3 /data/data/com.google.android.gsf/databases/gservices.db "select * from main where name = \"android_id\";"
Output example: android_id|<your_hex_gsf_id>
The GSF ID is the hexadecimal string after the pipe (e.g., 123abc456def7890).

Exit: exit
# NOTE that you never should reboot it
Steps to Register

Visit the Registration Page:
Go to https://www.google.com/android/uncertified/ in your web browser.
Sign in with the Google account you plan to use for OAuth in your app (or the primary account on the emulator). Complete any CAPTCHA if prompted.

Enter the GSF ID:
Once signed in, you'll see a simple form asking for your device's Android ID (GSF ID).
Paste 4201343188976539525 into the field.
Submit the form. You should get a confirmation message (e.g., "Your device has been registered").

Post-Registration Steps in the Emulator:
Connect via ADB: adb connect localhost:5555
Clear Play Services data to force a refresh: adb shell pm clear com.google.android.gms
If you have the Play Store app: adb shell pm clear com.android.vending
Reboot the emulator: adb reboot
Or restart the Docker container: sudo docker restart <container_name_or_id>
adb shell pm clear com.google.android.gms

|-------------------------------------------------------------------------------------------------------|

sudo docker system prune -a -f
sudo docker system prune -a -f --volumes

|-------------------------------------------------------------------------------------------------------|
# in case there is network issue
sudo modprobe veth
sudo modprobe br_netfilter
sudo systemctl restart docker

|-------------------------------------------------------------------------------------------------------|

# docker new mwthod

sudo chmod a+r /etc/apt/keyrings/docker.asc
sudo rm /etc/apt/sources.list.d/docker.list
sudo tee /etc/apt/sources.list.d/docker.sources <<EOF
Types: deb
URIs: https://download.docker.com/linux/ubuntu
Suites: noble
Components: stable
Signed-By: /etc/apt/keyrings/docker.asc
EOF
sudo apt update
sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin
sudo systemctl start docker
sudo systemctl enable docker

|-------------------------------------------------------------------------------------------------------|

curl -fsSL https://tailscale.com/install.sh | sh

# 1. Prepare data directories (once)
mkdir -p ~/data11 ~/data12 ~/data13

# 2. Create a dedicated Docker network for each instance (keeps things tidy)
sudo docker network create redroid1-net
sudo docker network create redroid2-net
sudo docker network create redroid3-net

sudo docker run -d --name ts1 --restart unless-stopped \
  --cap-add=NET_ADMIN --cap-add=NET_RAW --device=/dev/net/tun \
  -v /var/lib/tailscale1:/var/lib/tailscale \
  -e TS_AUTHKEY=tskey-api-kw7jymRneJ11CNTRL-8Rga2JhkRy3S3fDQUDj8z3RPmYe1aJf4 \
  -e TS_EXTRA_ARGS="--exit-node=auto:any --exit-node-allow-lan-access=true" \
  tailscale/tailscale tailscaled

sudo docker stop redroid_test
sudo docker rm redroid_test

sudo docker run -d --privileged --restart unless-stopped --name redroid_test \
  -v ~/data_test:/data \
  -p 5558:5555 \
  --net=container:ts_test \
  erstt/redroid:13.0.0_ndk_magisk_litegapps_ChromeOS

  sudo docker run -d --privileged --restart unless-stopped --name redroid_test \
  -v ~/data_test:/data \
  -p 5559:5555 \
  --network redroid_test_net \
  erstt/redroid:13.0.0_ndk_magisk_litegapps_ChromeOS

  # 1. Clean up
sudo docker stop ts_test redroid_test 2>/dev/null || true
sudo docker rm -f ts_test redroid_test 2>/dev/null || true
sudo docker network rm redroid_test_net 2>/dev/null || true
sudo docker network create redroid_test_net

# 2. Tailscale container (official image, userspace, --reset to avoid loop)
sudo docker run -d --name ts_test --restart unless-stopped --privileged \
  --cap-add=NET_ADMIN --cap-add=NET_RAW \
  -v /var/lib/tailscale1:/var/lib/tailscale \
  -e TS_AUTHKEY=tskey-auth-k4jJUjV2PJ11CNTRL-XiazdcLY6mfDeNSRdkXFkfzPwVDonGdaZ \
  -e TS_STATE_DIR=/var/lib/tailscale \
  -e TS_USERSPACE=true \
  tailscale/tailscale:latest tailscale up --reset --authkey=${TS_AUTHKEY} --exit-node=auto:any --exit-node-allow-lan-access=true


# 1. Connect the running Tailscale container to the network
sudo docker network connect redroid_test_net ts_test
# 2. Run Redroid using Tailscale's network stack
sudo docker run -d --privileged --restart unless-stopped --name redroid_test \
  -v ~/data_test:/data \
  -p 5559:5555 \
  --network container:ts_test \ 
  erstt/redroid:13.0.0_ndk_magisk_litegapps_ChromeOS

  